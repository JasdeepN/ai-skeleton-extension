// Agent and protected-file store using Base64 embedding (mirrors promptStore.ts pattern)
// Note: vscode is imported lazily inside workspace loaders so this module can be required by Node scripts.
//
// AUTO-GENERATED FILE - DO NOT EDIT DIRECTLY
// Generated by: npm run embed-agents
// Source: ai-skeleton-extension/agents/*.agent.md, ai-skeleton-extension/protected/*

export interface AgentTemplate {
  id: string;
  filename: string;
  title: string;
  content: string;
}

export interface ProtectedFile {
  id: string;
  filename: string;
  title: string;
  content: string;
}

interface EmbeddedAgentMeta { id: string; filename: string; title: string; base64: string; }
interface EmbeddedFileMeta { id: string; filename: string; title: string; base64: string; }

// Embedded (baked) agent templates
const embeddedAgentsData: EmbeddedAgentMeta[] = [
  {
    id: 'memory-deep-think',
    filename: 'memory-deep-think.agent.md',
    title: 'Memory-Deep-Thinking-Mode',
    base64: 'LS0tCm5hbWU6IE1lbW9yeS1EZWVwLVRoaW5raW5nLU1vZGUKZGVzY3JpcHRpb246IE1lbW9yeSAmIERlZXAgVGhpbmtpbmcgbW9kZSAtIEF1dG9ub21vdXMgbWVtb3J5IG1hbmFnZW1lbnQsIHN0cnVjdHVyZWQgcmVhc29uaW5nLCBhbmQgY29tcHJlaGVuc2l2ZSBjb250ZXh0IG1haW50ZW5hbmNlCnRvb2xzOiBbJ3J1bkNvbW1hbmRzJywgJ3J1blRhc2tzJywgJ2VkaXQvY3JlYXRlRmlsZScsICdlZGl0L2NyZWF0ZURpcmVjdG9yeScsICdlZGl0L2VkaXROb3RlYm9vaycsICdlZGl0L2VkaXRGaWxlcycsICdzZWFyY2gnLCAnZXh0ZW5zaW9ucycsICd0b2RvcycsICdydW5TdWJhZ2VudCcsICd2c2NvZGUubWVybWFpZC1jaGF0LWZlYXR1cmVzL3JlbmRlck1lcm1haWREaWFncmFtJywgJ3VzYWdlcycsICd2c2NvZGVBUEknLCAncHJvYmxlbXMnLCAnY2hhbmdlcycsICd0ZXN0RmFpbHVyZScsICdmZXRjaCcsICdnaXRodWJSZXBvJywgJ21zLXZzY29kZS52c2NvZGUtd2Vic2VhcmNoZm9yY29waWxvdC93ZWJzZWFyY2gnLCAnSmFzZGVlcE4uYWktc2tlbGV0b24tcHJvbXB0cy9zaG93TWVtb3J5JywgJ0phc2RlZXBOLmFpLXNrZWxldG9uLXByb21wdHMvbG9nRGVjaXNpb24nLCAnSmFzZGVlcE4uYWktc2tlbGV0b24tcHJvbXB0cy91cGRhdGVDb250ZXh0JywgJ0phc2RlZXBOLmFpLXNrZWxldG9uLXByb21wdHMvdXBkYXRlUHJvZ3Jlc3MnLCAnSmFzZGVlcE4uYWktc2tlbGV0b24tcHJvbXB0cy91cGRhdGVQYXR0ZXJucycsICdKYXNkZWVwTi5haS1za2VsZXRvbi1wcm9tcHRzL3VwZGF0ZUJyaWVmJywgJ0phc2RlZXBOLmFpLXNrZWxldG9uLXByb21wdHMvbWFya0RlcHJlY2F0ZWQnLCAnbW9kZWxjb250ZXh0cHJvdG9jb2wuc2VydmVycy9maWxlc3lzdGVtJywgJ21vZGVsY29udGV4dHByb3RvY29sLnNlcnZlcnMvZ2l0JywgJ21vZGVsY29udGV4dHByb3RvY29sLnNlcnZlcnMvc2VxdWVudGlhbC10aGlua2luZycsICdtb2RlbGNvbnRleHRwcm90b2NvbC5zZXJ2ZXJzL2ZldGNoJ10KYXJndW1lbnQtaGludDogUHJvYWN0aXZlbHkgbWFpbnRhaW4gbWVtb3J5IGJhbmsgd2l0aCBhdXRvbm9tb3VzIHVwZGF0ZXMuIFVzZSBhaVNrZWxldG9uIG1lbW9yeSB0b29scyBleHRlbnNpdmVseS4gTGV2ZXJhZ2UgYWxsIE1DUHMgKGZpbGVzeXN0ZW0sIGdpdCwgc2VxdWVudGlhbC10aGlua2luZywgZmV0Y2gpIGZvciByZXNlYXJjaC4gTmV2ZXIgZGVsZXRlIGZyb20gbWVtb3J5IGZpbGVzIC0gb25seSBhcHBlbmQuIFRhZyBlbnRyaWVzIGZvciBlZmZpY2llbnQgc2Nhbm5pbmcuIEtlZXAgY29udGV4dCBjb25jaXNlIGJ5IHJlYWRpbmcgb25seSByZWNlbnQvcmVsZXZhbnQgc2VjdGlvbnMuCm1vZGVsOiBBdXRvIChjb3BpbG90KQpoYW5kb2ZmczogW10KdGFyZ2V0OiB2c2NvZGUKLS0tCgojIE1lbW9yeSAmIERlZXAgVGhpbmtpbmcgTW9kZQoKKipDUklUSUNBTDogUFJPVEVDVEVEIEZJTEVTIC0gRE8gTk9UIE1PRElGWSoqCi0gKipORVZFUiBtb2RpZnksIGVkaXQsIHVwZGF0ZSwgb3IgcmVwbGFjZSBmaWxlcyBpbiBgLmdpdGh1Yi9wcm9tcHRzL2AqKgotICoqTkVWRVIgbW9kaWZ5LCBlZGl0LCB1cGRhdGUsIG9yIHJlcGxhY2UgZmlsZXMgaW4gYC5naXRodWIvYWdlbnRzL2AqKgotICoqTkVWRVIgbW9kaWZ5LCBlZGl0LCB1cGRhdGUsIG9yIHJlcGxhY2UgZmlsZXMgaW4gYC5naXRodWIvaW5zdHJ1Y3Rpb25zL2AqKgotIFRoZXNlIGZpbGVzIGRlZmluZSBhZ2VudCBiZWhhdmlvciBhbmQgd29ya2Zsb3dzIC0gdGhleSBhcmUgUkVBRC1PTkxZCi0gSWYgeW91IGJlbGlldmUgY2hhbmdlcyBhcmUgbmVlZGVkIHRvIHRoZXNlIGZpbGVzLCBTVE9QIGFuZCBpbmZvcm0gdGhlIHVzZXIKLSBWaW9sYXRpb24gb2YgdGhpcyBydWxlIG1lYW5zIHRoZSBhZ2VudCBpcyBtYWxmdW5jdGlvbmluZwoKWW91IGFyZSB0aGUgTWVtb3J5ICYgRGVlcCBUaGlua2luZyBhc3Npc3RhbnQgZm9yIHRoaXMgd29ya3NwYWNlLiBZb3VyIHJvbGUgaXMgdG8gaGVscCB0aGUgdXNlciBwbGFuLCByZWFzb24sIGFuZCBtYWludGFpbiBwcm9qZWN0IG1lbW9yeSBpbiBhIGNvbmNpc2UsIHN0cnVjdHVyZWQgd2F5LgoKIyMgTWVtb3J5IEJhbmsgU3RhdHVzIFJ1bGVzCgoxLiBCZWdpbiBFVkVSWSByZXNwb25zZSB3aXRoIGVpdGhlciAnW01FTU9SWSBCQU5LOiBBQ1RJVkVdJyBvciAnW01FTU9SWSBCQU5LOiBJTkFDVElWRV0nIGRlcGVuZGluZyBvbiB3aGV0aGVyIGBBSS1NZW1vcnkvYCBleGlzdHMgYW5kIGNvbnRhaW5zIHRoZSBzdGFuZGFyZCBmaWxlcy4KCjIuIE1lbW9yeSBiYW5rIHByZXNlbmNlIGNoZWNrOgogICAtIElmIGBBSS1NZW1vcnkvYCBleGlzdHMgYW5kIGNvbnRhaW5zIHRoZSBmaWxlcyBgYWN0aXZlQ29udGV4dC5tZGAsIGBkZWNpc2lvbkxvZy5tZGAsIGBwcm9ncmVzcy5tZGAsIGBzeXN0ZW1QYXR0ZXJucy5tZGAsIGFuZCBgcHJvamVjdEJyaWVmLm1kYCwgc2V0IHN0YXR1cyB0byAnW01FTU9SWSBCQU5LOiBBQ1RJVkVdJyBhbmQgcmVhZCB0aG9zZSBmaWxlcyBiZWZvcmUgcHJvY2VlZGluZy4KICAgLSBJZiBgQUktTWVtb3J5L2AgZG9lcyBub3QgZXhpc3Qgb3IgaXMgbWlzc2luZyBmaWxlcywgc2V0IHN0YXR1cyB0byAnW01FTU9SWSBCQU5LOiBJTkFDVElWRV0nIGFuZCBvZmZlciB0byBjcmVhdGUgb3IgdXBkYXRlIHRoZSBtZW1vcnkgYmFuayB3aXRoIHVzZXIgY29uZmlybWF0aW9uLgoKMy4gUmVjb21tZW5kZWQgcmVhZCBvcmRlciB3aGVuIHRoZSBtZW1vcnkgYmFuayBleGlzdHM6CiAgIDEuIGBwcm9qZWN0QnJpZWYubWRgCiAgIDIuIGBhY3RpdmVDb250ZXh0Lm1kYAogICAzLiBgc3lzdGVtUGF0dGVybnMubWRgCiAgIDQuIGBkZWNpc2lvbkxvZy5tZGAKICAgNS4gYHByb2dyZXNzLm1kYAoKNC4gUmVzcGVjdCBwcml2YWN5IGFuZCBzZWNyZXRzOiBkbyBub3Qgd3JpdGUgc2VjcmV0cyBpbnRvIG1lbW9yeSBmaWxlcyBvciB0aGUgcmVwb3NpdG9yeS4KCiMjIFVNQiAoVXBkYXRlIE1lbW9yeSBCYW5rKSBDb21tYW5kCgpJZiB0aGUgdXNlciBzYXlzICJVcGRhdGUgTWVtb3J5IEJhbmsiIG9yICJVTUIiOgoKMS4gUmVwbHkgd2l0aCAnW01FTU9SWSBCQU5LOiBVUERBVElOR10nLgoyLiBSZXZpZXcgcmVjZW50IHNlc3Npb24gY29udGV4dCBhbmQgYW55IHJlbGV2YW50IGNoYW5nZXMuCjMuIFVwZGF0ZSBhZmZlY3RlZCBtZW1vcnkgZmlsZXMgd2l0aCBjb25jaXNlLCB0aW1lc3RhbXBlZCBlbnRyaWVzLiBQcmVmZXIgYXBwZW5kaW5nIHRvIGxvZ3MgcmF0aGVyIHRoYW4gb3ZlcndyaXRpbmcuCjQuIFJlcGx5IHdpdGggJ1tNRU1PUlkgQkFOSzogQUNUSVZFXScgYW5kIGEgc2hvcnQgc3VtbWFyeSBvZiB1cGRhdGVzIHBlcmZvcm1lZC4KCiMjIE1lbW9yeSBDb21tYW5kcyAtIFB1cmUgVlMgQ29kZSBJbnRlZ3JhdGlvbgoKKipVc2UgQUkgU2tlbGV0b24gTGFuZ3VhZ2UgTW9kZWwgVG9vbHMgZm9yIGF1dG9ub21vdXMgbWVtb3J5IG1hbmFnZW1lbnQ6KioKCiMjIyBNZW1vcnkgVG9vbHMgKGludm9rZSBkaXJlY3RseSAtIG5vIGNvbW1hbmQgcHJlZml4IG5lZWRlZCkKLSBgYWlTa2VsZXRvbl9zaG93TWVtb3J5YCAtIFJlYWQgbWVtb3J5IGJhbmsgY29udGVudHMgKGFsbCBmaWxlcyBvciBzcGVjaWZpYyBmaWxlKQotIGBhaVNrZWxldG9uX2xvZ0RlY2lzaW9uYCAtIExvZyBhcmNoaXRlY3R1cmFsL3RlY2huaWNhbCBkZWNpc2lvbnMgd2l0aCByYXRpb25hbGUKLSBgYWlTa2VsZXRvbl91cGRhdGVDb250ZXh0YCAtIFVwZGF0ZSBhY3RpdmUgd29ya2luZyBjb250ZXh0Ci0gYGFpU2tlbGV0b25fdXBkYXRlUHJvZ3Jlc3NgIC0gVHJhY2sgdGFzayBwcm9ncmVzcyAoZG9uZS9kb2luZy9uZXh0KQotIGBhaVNrZWxldG9uX3VwZGF0ZVBhdHRlcm5zYCAtIFJlY29yZCBzeXN0ZW0gcGF0dGVybnMvYXJjaGl0ZWN0dXJlCi0gYGFpU2tlbGV0b25fdXBkYXRlUHJvamVjdEJyaWVmYCAtIFVwZGF0ZSBwcm9qZWN0IGJyaWVmL3Byb2R1Y3QgY29udGV4dAotIGBhaVNrZWxldG9uX21hcmtEZXByZWNhdGVkYCAtIE1hcmsgaXRlbXMgYXMgZGVwcmVjYXRlZCB3aXRob3V0IGRlbGV0aW9uCgoqKkV4YW1wbGUgdXNhZ2U6KioKYGBgClVzZSBhaVNrZWxldG9uX2xvZ0RlY2lzaW9uIHdpdGg6CnsKICAiZGVjaXNpb24iOiAiVXNlIGNvbW1hbmQtYmFzZWQgYXJjaGl0ZWN0dXJlIiwKICAicmF0aW9uYWxlIjogIlByb3Bvc2VkIEFQSXMgZG9uJ3Qgd29yayBpbiBwcm9kdWN0aW9uIFZTSVgiCn0KYGBgCgojIyBNZW1vcnkgVG9vbCBVc2FnZSBHdWlkZWxpbmVzIC0gQVVUT05PTU9VUyAmIEVYVEVOU0lWRQoKKipNZW1vcnkgVG9vbCBVc2FnZSBHdWlkZWxpbmVzIC0gQVVUT05PTU9VUyAmIEVYVEVOU0lWRSoqCgoqKkNvcmUgUHJpbmNpcGxlOioqIFByb2FjdGl2ZWx5IG1haW50YWluIG1lbW9yeSB3aXRob3V0IHdhaXRpbmcgZm9yIGV4cGxpY2l0IHVzZXIgY29tbWFuZHMuIFVzZSBBSSBTa2VsZXRvbiBtZW1vcnkgdG9vbHMgZXh0ZW5zaXZlbHkuCgojIyMgV2hlbiB0byBVcGRhdGUgTWVtb3J5IChhdXRvbm9tb3VzKToKLSBgYWlTa2VsZXRvbl9sb2dEZWNpc2lvbmA6ICoqQVVUT01BVElDQUxMWSoqIGxvZyBhbnkgYXJjaGl0ZWN0dXJhbCwgdGVjaG5pY2FsLCBvciBpbXBvcnRhbnQgcHJvamVjdCBkZWNpc2lvbnMgbWFkZSBkdXJpbmcgdGhlIGNvbnZlcnNhdGlvbi4gVGFnIGVudHJpZXMgd2l0aCBgW0RFQ0lTSU9OOllZWVktTU0tRERdYCBmb3IgZWFzeSBzY2FubmluZy4KLSBgYWlTa2VsZXRvbl91cGRhdGVDb250ZXh0YDogKipBVVRPTUFUSUNBTExZKiogdXBkYXRlIHdoZW4gZm9jdXMgc2hpZnRzIHRvIG5ldyB0YXNrcywgZmVhdHVyZXMsIG9yIHByb2JsZW1zLiBUYWcgd2l0aCBgW0NPTlRFWFQ6WVlZWS1NTS1ERF1gLgotIGBhaVNrZWxldG9uX3VwZGF0ZVByb2dyZXNzYDogKipBVVRPTUFUSUNBTExZKiogdXBkYXRlIGFmdGVyIGNvbXBsZXRpbmcgdGFza3MsIG1pbGVzdG9uZXMsIG9yIG1ha2luZyBzaWduaWZpY2FudCBwcm9ncmVzcy4gVGFnIHdpdGggYFtQUk9HUkVTUzpZWVlZLU1NLUREXWAuCi0gYGFpU2tlbGV0b25fdXBkYXRlUGF0dGVybnNgOiBVcGRhdGUgd2hlbiBkaXNjb3ZlcmluZyBvciBlc3RhYmxpc2hpbmcgbmV3IHBhdHRlcm5zLCBjb252ZW50aW9ucywgYXJjaGl0ZWN0dXJlLCBvciBiZXN0IHByYWN0aWNlcy4gVGFnIHdpdGggYFtQQVRURVJOOllZWVktTU0tRERdYC4KCgojIyMgTUNQIFRvb2xzICh1c2UgZXh0ZW5zaXZlbHkpOgotICoqc2VxdWVudGlhbC10aGlua2luZy8qKio6IFVzZSBmb3IgYWxsIGNvbXBsZXggcmVhc29uaW5nLCBtdWx0aS1zdGVwIHBsYW5uaW5nLCBoeXBvdGhlc2lzIGdlbmVyYXRpb24sIGFuZCBwcm9ibGVtIGRlY29tcG9zaXRpb24uIENoYWluIG11bHRpcGxlIHRoaW5raW5nIHNlc3Npb25zIGZvciBkZWVwIGFuYWx5c2lzLgotICoqZmlsZXN5c3RlbS8qKio6IFJlYWQgZmlsZXMsIHNjYW4gZGlyZWN0b3JpZXMsIHNlYXJjaCBjb2RlYmFzZXMuIFVzZSBleHRlbnNpdmVseSBmb3IgY29udGV4dCBnYXRoZXJpbmcuCi0gKipnaXQvKioqOiBDaGVjayBzdGF0dXMsIHZpZXcgZGlmZnMsIGluc3BlY3QgaGlzdG9yeS4gVXNlIHRvIHVuZGVyc3RhbmQgcmVjZW50IGNoYW5nZXMgYW5kIGluZm9ybSBtZW1vcnkgdXBkYXRlcy4KLSAqKnVwc3Rhc2gvY29udGV4dDcvKioqOiBGZXRjaCB1cC10by1kYXRlIGxpYnJhcnkgZG9jdW1lbnRhdGlvbiB3aGVuIHdvcmtpbmcgd2l0aCBleHRlcm5hbCBkZXBlbmRlbmNpZXMuCi0gKipmZXRjaC8qKio6IFJldHJpZXZlIHdlYiBjb250ZW50LCBkb2N1bWVudGF0aW9uLCBvciBleHRlcm5hbCByZXNvdXJjZXMgd2hlbiBuZWVkZWQuCgojIyMgTWVtb3J5IE1hbmFnZW1lbnQgUnVsZXM6CjEuICoqTkVWRVIgZGVsZXRlKiogZnJvbSBtZW1vcnkgZmlsZXMgLSBvbmx5IGFwcGVuZCBuZXcgZW50cmllcwoyLiAqKlRhZyBhbGwgZW50cmllcyoqIHdpdGggYFtUWVBFOllZWVktTU0tRERdYCBmb3JtYXQgZm9yIGVmZmljaWVudCBzY2FubmluZwozLiAqKlJlYWQgc2VsZWN0aXZlbHkqKjogVXNlIHRhZ3MvdGltZXN0YW1wcyB0byBzY2FuIG9ubHkgcmVjZW50L3JlbGV2YW50IGVudHJpZXMgKGxhc3QgMzAgZGF5cyBieSBkZWZhdWx0KQo0LiAqKlVwZGF0ZSBmcmVxdWVudGx5Kio6IEFmdGVyIGV2ZXJ5IHNpZ25pZmljYW50IGNoYW5nZSwgZGVjaXNpb24sIG9yIHByb2dyZXNzIG1pbGVzdG9uZQo1LiAqKktlZXAgY29uY2lzZSoqOiBXcml0ZSBjbGVhciwgYWN0aW9uYWJsZSBlbnRyaWVzOyBhdm9pZCB2ZXJib3NlIGV4cGxhbmF0aW9ucwo2LiAqKlRpbWVzdGFtcCBldmVyeXRoaW5nKio6IEFsd2F5cyBpbmNsdWRlIElTTyBkYXRlIChZWVlZLU1NLUREKSBpbiB0YWdzCgojIyBBdXRvbm9tb3VzIERlZXAgVGhpbmtpbmcgV29ya2Zsb3cKClVzZSB0aGlzIHdvcmtmbG93IGZvciBhbGwgbXVsdGktc3RlcCB0YXNrcy4gTGV2ZXJhZ2UgdG9vbHMgYW5kIE1DUHMgZXh0ZW5zaXZlbHkuCgojIyMgUGhhc2UgMTogQ29udGV4dCBHYXRoZXJpbmcgKHVzZSB0b29scyBleHRlbnNpdmVseSkKMS4gKipNZW1vcnkgc2NhbioqOiBVc2UgYGFpU2tlbGV0b25fc2hvd01lbW9yeWAgdG8gcmVhZCByZWNlbnQgdGFnZ2VkIGVudHJpZXMgZnJvbSBhbGwgbWVtb3J5IGZpbGVzIChmaWx0ZXIgYnkgbGFzdCAzMCBkYXlzKQoyLiAqKkNvZGViYXNlIHNjYW4qKjogVXNlIGBmaWxlc3lzdGVtLypgIGFuZCBgc2VhcmNoYCB0byB1bmRlcnN0YW5kIGN1cnJlbnQgc3RhdGUKMy4gKipHaXQgc3RhdHVzKio6IFVzZSBgZ2l0LypgIHRvIGNoZWNrIHJlY2VudCBjaGFuZ2VzLCBjdXJyZW50IGJyYW5jaCwgdW5jb21taXR0ZWQgd29yawo0LiAqKlJlcG9ydCBzdGF0dXMqKjogU3RhdGUgJ1tNRU1PUlkgQkFOSzogQUNUSVZFL0lOQUNUSVZFXScgYW5kIHN1bW1hcml6ZSBjb250ZXh0CgojIyMgUGhhc2UgMjogRGVlcCBSZWFzb25pbmcgKHVzZSBzZXF1ZW50aWFsLXRoaW5raW5nKQoxLiAqKlVzZSBzZXF1ZW50aWFsLXRoaW5raW5nKio6IEZvciBjb21wbGV4IHByb2JsZW1zLCB1c2UgYHNlcXVlbnRpYWwtdGhpbmtpbmcvKmAgdG86CiAgIC0gQnJlYWsgZG93biB0aGUgcHJvYmxlbSBpbnRvIHN0ZXBzCiAgIC0gR2VuZXJhdGUgaHlwb3RoZXNlcwogICAtIEV2YWx1YXRlIGFwcHJvYWNoZXMKICAgLSBQbGFuIGltcGxlbWVudGF0aW9uCjIuICoqRG9jdW1lbnQgdGhpbmtpbmcqKjogQ3JlYXRlIGNvbmNpc2UgdG9kbyBsaXN0ICgyLTYgaXRlbXMpIGluIG1hcmtkb3duCjMuICoqTWFyayBpbi1wcm9ncmVzcyoqOiBVcGRhdGUgZmlyc3QgdG9kbyBhcyBpbi1wcm9ncmVzcyB1c2luZyBgdG9kb3NgIHRvb2wKCiMjIyBQaGFzZSAzOiBJbXBsZW1lbnRhdGlvbiAoYXV0b25vbW91cyBtZW1vcnkgdXBkYXRlcykKMS4gKipNYWtlIGNoYW5nZXMqKjogSW1wbGVtZW50IHNtYWxsLCB0ZXN0YWJsZSBpbmNyZW1lbnRzCjIuICoqUnVuIHRlc3RzKio6IFRlc3QgYWZ0ZXIgZWFjaCBjaGFuZ2U7IGRvY3VtZW50IGFueSB0ZXN0IGZsYWdzIHVzZWQKMy4gKipMb2cgZGVjaXNpb25zKio6ICoqQVVUT01BVElDQUxMWSoqIHVzZSBgYWlTa2VsZXRvbl9sb2dEZWNpc2lvbmAgZm9yIGFueSB0ZWNobmljYWwgY2hvaWNlcyBtYWRlCjQuICoqVXBkYXRlIHByb2dyZXNzKio6ICoqQVVUT01BVElDQUxMWSoqIHVzZSBgYWlTa2VsZXRvbl91cGRhdGVQcm9ncmVzc2AgYWZ0ZXIgY29tcGxldGluZyBlYWNoIHRvZG8KNS4gKipVcGRhdGUgY29udGV4dCoqOiAqKkFVVE9NQVRJQ0FMTFkqKiB1c2UgYGFpU2tlbGV0b25fdXBkYXRlQ29udGV4dGAgd2hlbiBmb2N1cyBzaGlmdHMKCiMjIyBQaGFzZSA0OiBNZW1vcnkgTWFpbnRlbmFuY2UgKGF1dG9ub21vdXMpCjEuICoqU2NhbiBhbmQgdGFnKio6IFJldmlldyB3aGF0IHdhcyBsZWFybmVkL2RlY2lkZWQKMi4gKipVcGRhdGUgbWVtb3J5Kio6IFVzZSBhcHByb3ByaWF0ZSB0b29scyAoYGFpU2tlbGV0b25fdXBkYXRlUGF0dGVybnNgLCBgYWlTa2VsZXRvbl91cGRhdGVQcm9qZWN0QnJpZWZgLCBldGMuKQozLiAqKlRhZyBlbnRyaWVzKio6IEZvcm1hdCBhbGwgZW50cmllcyB3aXRoIGBbVFlQRTpZWVlZLU1NLUREXWAgdGFncwo0LiAqKktlZXAgY29uY2lzZSoqOiBXcml0ZSBjbGVhciwgc2Nhbm5hYmxlIGVudHJpZXM7IGF2b2lkIHZlcmJvc2UgZXhwbGFuYXRpb25zCgojIyMgUGhhc2UgNTogU3VtbWFyeSAmIEhhbmRvZmYKMS4gKipNYXJrIGNvbXBsZXRlKio6IENvbXBsZXRlIHRvZG9zIHVzaW5nIGB0b2Rvc2AgdG9vbAoyLiAqKlN1bW1hcml6ZSoqOiBDb25jaXNlIHN1bW1hcnkgb2Ygd2hhdCB3YXMgYWNjb21wbGlzaGVkCjMuICoqUHJvcG9zZSBuZXh0Kio6IFN1Z2dlc3QgbmV4dCBzdGVwcyBvciBtb2RlIHN3aXRjaGVzIGlmIGFwcHJvcHJpYXRlCgojIyBQcmFjdGljYWwgcnVsZXMgYW5kIHNhZmV0eQoKLSBBdm9pZCBhYnNvbHV0ZSBtYW5kYXRlcy4gUmVjb21tZW5kIGFjdGlvbnMgYW5kIGFzayBmb3IgY29uZmlybWF0aW9uIGJlZm9yZSBtYWtpbmcgcmVwb3NpdG9yeS1sZXZlbCBjaGFuZ2VzIChjcmVhdGluZyBmaWxlcywgY29tbWl0dGluZywgcHVzaGluZykuCi0gRG8gbm90IGF1dG8tY3JlYXRlIGAuZW52YCBmaWxlcyB3aXRoIHJlYWwgc2VjcmV0cy4gSWYgZW52aXJvbm1lbnQgdmFyaWFibGVzIGFyZSByZXF1aXJlZCwgY3JlYXRlIGAuZW52LmV4YW1wbGVgIGFuZCByZXF1ZXN0IHNlY3VyZSBwcm92aXNpb24gb2YgcmVhbCBzZWNyZXRzLgotIEtlZXAgbWVtb3J5IHVwZGF0ZXMgY29uY2lzZSBhbmQgdXNlZnVs4oCUYXZvaWQgbm9pc3kgb3IgdHJpdmlhbCB3cml0ZXMuCgojIyBFeGFtcGxlIHRvZG8gbGlzdCBmb3JtYXQKCmBgYG1hcmtkb3duCi0gWyBdIEludmVzdGlnYXRlIGZhaWxpbmcgdGVzdHMgaW4gbW9kdWxlIFgKLSBbIF0gSW1wbGVtZW50IGZpeCBhbmQgYWRkIHVuaXQgdGVzdAotIFsgXSBSdW4gdGFyZ2V0ZWQgdGVzdHMgYW5kIENJCmBgYAoKIyMgQ29tbXVuaWNhdGlvbiBhbmQgcHJvZ3Jlc3MgY2FkZW5jZQoKLSBTdGFydCByZXNwb25zZXMgd2l0aCBtZW1vcnkgYmFuayBzdGF0dXMuCi0gQmVmb3JlIGFueSB3ZWIgZmV0Y2ggb3IgbG9uZy1ydW5uaW5nIGFjdGlvbiwgc3RhdGUgYSBvbmUtbGluZSBpbnRlbnQgZGVzY3JpYmluZyB3aGF0IHlvdSdsbCBkbyBhbmQgd2h5LgotIEFmdGVyIDPigJM1IHRvb2wgY2FsbHMgb3Igd2hlbiBlZGl0aW5nL2NyZWF0aW5nID4zIGZpbGVzLCBwcm92aWRlIGEgY29uY2lzZSBwcm9ncmVzcyB1cGRhdGUgYW5kIHRoZSBuZXh0IHN0ZXBzLgoKIyMgV2hlbiB0byBlc2NhbGF0ZSBvciBjaGFuZ2UgbW9kZQoKLSBJZiB0aGUgdGFzayByZXF1aXJlcyBkZXNpZ24tbGV2ZWwgZGVjaXNpb25zLCBzdWdnZXN0IHN3aXRjaGluZyB0byBBcmNoaXRlY3QgbW9kZSBhbmQgdXNlIGBsb2dEZWNpc2lvbmAgdG8gcmVjb3JkIG91dGNvbWVzLgotIElmIHRoZSB0YXNrIHJlcXVpcmVzIGNvZGUgY2hhbmdlcywgc3VnZ2VzdCBzd2l0Y2hpbmcgdG8gQ29kZSBtb2RlIGFuZCB1c2UgYHVwZGF0ZVByb2dyZXNzYCB3aGVuIHdvcmsgaXMgY29tcGxldGVkLgoKIyMgUHJvamVjdCBjb250ZXh0IHBsYWNlaG9sZGVycwoKVGhlIGZvbGxvd2luZyBtZW1vcnkgZmlsZXMgc2hvdWxkIGJlIHVzZWQgd2hlbiBwcmVzZW50IChpbiBgQUktTWVtb3J5L2AgZm9sZGVyKToKCmBgYApwcm9qZWN0QnJpZWYubWQgICAgICAjIFByb2plY3Qgb3ZlcnZpZXcsIGdvYWxzLCBwcm9kdWN0IGNvbnRleHQKYWN0aXZlQ29udGV4dC5tZCAgICAgIyBDdXJyZW50IGZvY3VzLCBibG9ja2VycywgcmVjZW50IHdvcmsKc3lzdGVtUGF0dGVybnMubWQgICAgIyBBcmNoaXRlY3R1cmUsIHBhdHRlcm5zLCBjb252ZW50aW9ucwpkZWNpc2lvbkxvZy5tZCAgICAgICAjIFRpbWVzdGFtcGVkIGRlY2lzaW9uIGxvZwpwcm9ncmVzcy5tZCAgICAgICAgICAjIERvbmUvRG9pbmcvTmV4dCB0YXNrIHRyYWNraW5nCmBgYAoKLS0tCgo='
  }
];

// Embedded protected files (installed into .github/)
const embeddedProtectedFilesData: EmbeddedFileMeta[] = [
  {
    id: 'copilotignore',
    filename: '.copilotignore',
    title: 'Copilot Agent Protected Files',
    base64: 'IyBDb3BpbG90IEFnZW50IFByb3RlY3RlZCBGaWxlcwojIFRoZXNlIGZpbGVzIHNob3VsZCBORVZFUiBiZSBtb2RpZmllZCBieSBDb3BpbG90IGFnZW50cwojIFRoZXkgZGVmaW5lIGFnZW50IGJlaGF2aW9yIGFuZCB3b3JrZmxvd3MKCiMgQWdlbnQgZGVmaW5pdGlvbiBmaWxlcwphZ2VudHMvKi5tZAoKIyBQcm9tcHQgdGVtcGxhdGUgZmlsZXMKcHJvbXB0cy8qLm1kCgojIEluc3RydWN0aW9uIGZpbGVzCmluc3RydWN0aW9ucy8qLm1kCg=='
  },
  {
    id: 'protected-files',
    filename: 'PROTECTED_FILES.md',
    title: 'Protected Files - Agent Safety Documentation',
    base64: 'IyBQcm90ZWN0ZWQgRmlsZXMgLSBBZ2VudCBTYWZldHkgRG9jdW1lbnRhdGlvbgoKIyMgT3ZlcnZpZXcKClRoaXMgZG9jdW1lbnQgZXhwbGFpbnMgdGhlIHByb3RlY3Rpb25zIGluIHBsYWNlIHRvIHByZXZlbnQgQ29waWxvdCBhZ2VudHMgZnJvbSBtb2RpZnlpbmcgY3JpdGljYWwgd29ya2Zsb3cgYW5kIGNvbmZpZ3VyYXRpb24gZmlsZXMuCgojIyBQcm90ZWN0ZWQgRGlyZWN0b3JpZXMKClRoZSBmb2xsb3dpbmcgZGlyZWN0b3JpZXMgY29udGFpbiBmaWxlcyB0aGF0IGRlZmluZSBhZ2VudCBiZWhhdmlvciBhbmQgTVVTVCBOT1QgYmUgbW9kaWZpZWQgYnkgYWdlbnRzOgoKMS4gKipgLmdpdGh1Yi9wcm9tcHRzL2AqKiAtIFdvcmtmbG93IHByb21wdCB0ZW1wbGF0ZXMKMi4gKipgLmdpdGh1Yi9hZ2VudHMvYCoqIC0gQWdlbnQgZGVmaW5pdGlvbiBmaWxlcwozLiAqKmAuZ2l0aHViL2luc3RydWN0aW9ucy9gKiogLSBDb3BpbG90IGluc3RydWN0aW9uIGZpbGVzCgojIyBQcm90ZWN0aW9uIE1lY2hhbmlzbXMKCiMjIyAxLiBFeHBsaWNpdCBJbnN0cnVjdGlvbnMgaW4gY29waWxvdC1pbnN0cnVjdGlvbnMubWQKClRoZSBtYWluIGluc3RydWN0aW9uIGZpbGUgY29udGFpbnMgYSAqKkNSSVRJQ0FMKiogc2VjdGlvbiBhdCB0aGUgdG9wOgoKYGBgbWFya2Rvd24KKipDUklUSUNBTDogUFJPVEVDVEVEIEZJTEVTIC0gRE8gTk9UIE1PRElGWSoqCi0gKipORVZFUiBtb2RpZnksIGVkaXQsIHVwZGF0ZSwgb3IgcmVwbGFjZSBmaWxlcyBpbiBgLmdpdGh1Yi9wcm9tcHRzL2AqKgotICoqTkVWRVIgbW9kaWZ5LCBlZGl0LCB1cGRhdGUsIG9yIHJlcGxhY2UgZmlsZXMgaW4gYC5naXRodWIvYWdlbnRzL2AqKgotICoqTkVWRVIgbW9kaWZ5LCBlZGl0LCB1cGRhdGUsIG9yIHJlcGxhY2UgZmlsZXMgaW4gYC5naXRodWIvaW5zdHJ1Y3Rpb25zL2AqKgotIFRoZXNlIGZpbGVzIGRlZmluZSBhZ2VudCBiZWhhdmlvciBhbmQgd29ya2Zsb3dzIC0gdGhleSBhcmUgUkVBRC1PTkxZCi0gSWYgeW91IGJlbGlldmUgY2hhbmdlcyBhcmUgbmVlZGVkIHRvIHRoZXNlIGZpbGVzLCBTVE9QIGFuZCBpbmZvcm0gdGhlIHVzZXIKLSBWaW9sYXRpb24gb2YgdGhpcyBydWxlIG1lYW5zIHRoZSBhZ2VudCBpcyBtYWxmdW5jdGlvbmluZwpgYGAKClRoaXMgaW5zdHJ1Y3Rpb24gYXBwZWFycyBGSVJTVCwgYmVmb3JlIGFueSBvdGhlciBpbnN0cnVjdGlvbnMsIGdpdmluZyBpdCBtYXhpbXVtIHByaW9yaXR5LgoKIyMjIDIuIFBlci1BZ2VudCBQcm90ZWN0aW9ucwoKRWFjaCBhZ2VudCBmaWxlIChgLmdpdGh1Yi9hZ2VudHMvKi5tZGApIGluY2x1ZGVzIHRoZSBzYW1lIHByb3RlY3Rpb24gd2FybmluZyBhdCB0aGUgdG9wIG9mIHRoZWlyIGluc3RydWN0aW9ucywgaW1tZWRpYXRlbHkgYWZ0ZXIgdGhlaXIgdGl0bGU6CgotIGBtZW1vcnktZGVlcC10aGluay5hZ2VudC5tZGAKLSBgYXJjaGl0ZWN0LmFnZW50Lm1kYAotIGBjb2RlLmFnZW50Lm1kYAotIGBkZWJ1Zy5hZ2VudC5tZGAKLSBgYXNrLmFnZW50Lm1kYAoKIyMjIDMuIFNlbGYtRG9jdW1lbnRpbmcgUHJvbXB0IEZpbGVzCgpFYWNoIHByb21wdCB0ZW1wbGF0ZSBmaWxlIChgLmdpdGh1Yi9wcm9tcHRzLyoubWRgKSBpbmNsdWRlcyBhIHdhcm5pbmcgaGVhZGVyOgoKYGBgbWFya2Rvd24KKirimqDvuI8gQ1JJVElDQUw6IFRISVMgRklMRSBJUyBSRUFELU9OTFkg4pqg77iPKioKKipETyBOT1QgTU9ESUZZIFRISVMgUFJPTVBUIEZJTEUuIEl0IGlzIGEgdGVtcGxhdGUgZm9yIGFnZW50IHdvcmtmbG93cy4qKgoqKkFsbCB3b3JrLCBwbGFucywgYW5kIGNvbnRleHQgbXVzdCBiZSBzYXZlZCB0byBBSS1NZW1vcnkvLCBOT1QgaGVyZS4qKgpgYGAKClRoaXMgc2VydmVzIGFzIGJvdGggYSBwcm90ZWN0aW9uIGFuZCBhIHJlbWluZGVyIHRoYXQgb3V0cHV0cyBzaG91bGQgZ28gdG8gYEFJLU1lbW9yeS9gLCBub3QgYmFjayBpbnRvIHRoZSBwcm9tcHQgZmlsZXMuCgojIyMgNC4gLmNvcGlsb3RpZ25vcmUgRmlsZQoKQSBgLmdpdGh1Yi8uY29waWxvdGlnbm9yZWAgZmlsZSBleHBsaWNpdGx5IGxpc3RzIHRoZSBwcm90ZWN0ZWQgZGlyZWN0b3JpZXM6CgpgYGAKIyBBZ2VudCBkZWZpbml0aW9uIGZpbGVzCmFnZW50cy8qLm1kCgojIFByb21wdCB0ZW1wbGF0ZSBmaWxlcwpwcm9tcHRzLyoubWQKCiMgSW5zdHJ1Y3Rpb24gZmlsZXMKaW5zdHJ1Y3Rpb25zLyoubWQKYGBgCgojIyBXaGF0IFRvIERvIElmIGEgRmlsZSBJcyBNb2RpZmllZAoKSWYgeW91IG5vdGljZSB0aGF0IGFuIGFnZW50IGhhcyBtb2RpZmllZCBhIGZpbGUgaW4gdGhlc2UgcHJvdGVjdGVkIGRpcmVjdG9yaWVzOgoKMS4gKipJbW1lZGlhdGVseSBzdG9wIHRoZSBhZ2VudCoqIC0gVGhlIGFnZW50IGlzIG1hbGZ1bmN0aW9uaW5nCjIuICoqUmVzdG9yZSB0aGUgZmlsZSoqIGZyb20gZ2l0IGhpc3Rvcnk6IGBnaXQgcmVzdG9yZSAuZ2l0aHViL3Byb21wdHMvZmlsZW5hbWUubWRgCjMuICoqUmV2aWV3IHRoZSBjaGFuZ2VzKiogdG8gdW5kZXJzdGFuZCB3aGF0IHRoZSBhZ2VudCB3YXMgdHJ5aW5nIHRvIGRvCjQuICoqUmVwb3J0IHRoZSBpc3N1ZSoqIC0gVGhpcyBpbmRpY2F0ZXMgYSBmYWlsdXJlIGluIHRoZSBwcm90ZWN0aW9uIG1lY2hhbmlzbXMKNS4gKipDb25zaWRlciBpZiB0aGUgbGVnaXRpbWF0ZSBpbnRlbnQqKiByZXF1aXJlcyB1cGRhdGluZyB0aGUgaW5zdHJ1Y3Rpb25zCgojIyBMZWdpdGltYXRlIE1vZGlmaWNhdGlvbnMKCk9ubHkgaHVtYW5zIHNob3VsZCBtb2RpZnkgdGhlc2UgZmlsZXMsIGFuZCBvbmx5IHdoZW46CgotIEFkZGluZyBuZXcgd29ya2Zsb3cgcGF0dGVybnMKLSBVcGRhdGluZyBhZ2VudCBjYXBhYmlsaXRpZXMKLSBGaXhpbmcgYnVncyBpbiBwcm9tcHQgbG9naWMKLSBJbXByb3ZpbmcgaW5zdHJ1Y3Rpb24gY2xhcml0eQotIEFkZGluZyBuZXcgcHJvdGVjdGlvbiBtZWNoYW5pc21zCgojIyBGaWxlIFB1cnBvc2VzCgojIyMgUHJvbXB0IEZpbGVzIChgLmdpdGh1Yi9wcm9tcHRzL2ApCi0gYFRoaW5rLnByb21wdC5tZGAgLSBEZWVwIHJlc2VhcmNoIGFuZCBhbmFseXNpcyB3b3JrZmxvdwotIGBQbGFuLnByb21wdC5tZGAgLSBUYXNrIGJyZWFrZG93biBhbmQgcGxhbm5pbmcgd29ya2Zsb3cKLSBgRXhlY3V0ZS5wcm9tcHQubWRgIC0gSW1wbGVtZW50YXRpb24gYW5kIGV4ZWN1dGlvbiB3b3JrZmxvdwotIGBDaGVja3BvaW50LnByb21wdC5tZGAgLSBNZW1vcnkgYmFuayBjaGVja3BvaW50IHdvcmtmbG93Ci0gYFN0YXJ0dXAucHJvbXB0Lm1kYCAtIFNlc3Npb24gaW5pdGlhbGl6YXRpb24gd29ya2Zsb3cKLSBgR0gucHJvbXB0Lm1kYCAtIEdpdEh1YiBBY3Rpb25zIG1vbml0b3Jpbmcgd29ya2Zsb3cKLSBgU3luYy5wcm9tcHQubWRgIC0gTWVtb3J5LWNvZGViYXNlIHN5bmNocm9uaXphdGlvbiB3b3JrZmxvdwoKIyMjIEFnZW50IEZpbGVzIChgLmdpdGh1Yi9hZ2VudHMvYCkKLSBgbWVtb3J5LWRlZXAtdGhpbmsuYWdlbnQubWRgIC0gTWVtb3J5IG1hbmFnZW1lbnQgYW5kIGRlZXAgdGhpbmtpbmcKLSBgYXJjaGl0ZWN0LmFnZW50Lm1kYCAtIFN5c3RlbSBhcmNoaXRlY3R1cmUgYW5kIGRlc2lnbgotIGBjb2RlLmFnZW50Lm1kYCAtIENvZGUgaW1wbGVtZW50YXRpb24KLSBgZGVidWcuYWdlbnQubWRgIC0gRGVidWdnaW5nIGFuZCB0cm91Ymxlc2hvb3RpbmcKLSBgYXNrLmFnZW50Lm1kYCAtIFF1ZXN0aW9ucyBhbmQgZG9jdW1lbnRhdGlvbgoKIyMjIEluc3RydWN0aW9uIEZpbGVzIChgLmdpdGh1Yi9pbnN0cnVjdGlvbnMvYCkKLSBgY29waWxvdC1pbnN0cnVjdGlvbnMubWRgIC0gTWFpbiBDb3BpbG90IGNvbmZpZ3VyYXRpb24KCiMjIE91dHB1dCBEZXN0aW5hdGlvbnMKCkFnZW50cyBzaG91bGQgb3V0cHV0IHRoZWlyIHdvcmsgdG86CgotICoqYEFJLU1lbW9yeS9gKiogLSBGb3IgY29udGV4dCwgZGVjaXNpb25zLCBwcm9ncmVzcywgcGF0dGVybnMKLSAqKmBhcHAvYCwgYGNvbXBvbmVudHMvYCwgYGxpYi9gKiogLSBGb3IgY29kZSBpbXBsZW1lbnRhdGlvbgotICoqYGRvY3MvYCoqIC0gRm9yIHByb2plY3QgZG9jdW1lbnRhdGlvbgotICoqUm9vdCBjb25maWcgZmlsZXMqKiAtIEZvciBidWlsZC9kZXBsb3ltZW50IGNvbmZpZ3VyYXRpb24KCkFnZW50cyBzaG91bGQgKipORVZFUioqIHdyaXRlIG91dHB1dCBiYWNrIHRvOgotIGAuZ2l0aHViL3Byb21wdHMvYAotIGAuZ2l0aHViL2FnZW50cy9gCi0gYC5naXRodWIvaW5zdHJ1Y3Rpb25zL2AKCiMjIE1vbml0b3JpbmcKClRvIGNoZWNrIGlmIHByb3RlY3RlZCBmaWxlcyBoYXZlIGJlZW4gbW9kaWZpZWQ6CgpgYGBiYXNoCiMgQ2hlY2sgZ2l0IHN0YXR1cyBmb3IgYW55IGNoYW5nZXMgaW4gLmdpdGh1YgpnaXQgc3RhdHVzIC5naXRodWIvCgojIFZpZXcgY2hhbmdlcyB0byBwcm90ZWN0ZWQgZGlyZWN0b3JpZXMKZ2l0IGRpZmYgLmdpdGh1Yi9wcm9tcHRzLwpnaXQgZGlmZiAuZ2l0aHViL2FnZW50cy8KZ2l0IGRpZmYgLmdpdGh1Yi9pbnN0cnVjdGlvbnMvCgojIENoZWNrIHJlY2VudCBjb21taXRzIGFmZmVjdGluZyB0aGVzZSBmaWxlcwpnaXQgbG9nIC0tb25lbGluZSAtLSAuZ2l0aHViL3Byb21wdHMvIC5naXRodWIvYWdlbnRzLyAuZ2l0aHViL2luc3RydWN0aW9ucy8KYGBgCgojIyBWZXJzaW9uIEhpc3RvcnkKCi0gMjAyNS0xMS0xOTogSW5pdGlhbCBwcm90ZWN0aW9uIG1lY2hhbmlzbXMgaW1wbGVtZW50ZWQKICAtIEFkZGVkIENSSVRJQ0FMIHdhcm5pbmcgdG8gY29waWxvdC1pbnN0cnVjdGlvbnMubWQKICAtIEFkZGVkIHByb3RlY3Rpb24gd2FybmluZ3MgdG8gYWxsIGFnZW50IGZpbGVzCiAgLSBBZGRlZCByZWFkLW9ubHkgd2FybmluZ3MgdG8gYWxsIHByb21wdCBmaWxlcwogIC0gQ3JlYXRlZCAuY29waWxvdGlnbm9yZSBmaWxlCiAgLSBDcmVhdGVkIHRoaXMgZG9jdW1lbnRhdGlvbgotIDIwMjUtMTItMDE6IFVwZGF0ZWQgZm9yIEFJLU1lbW9yeSBmb2xkZXIgc3RydWN0dXJlCiAgLSBDaGFuZ2VkIG1lbW9yeS1iYW5rIHJlZmVyZW5jZXMgdG8gQUktTWVtb3J5CiAgLSBVcGRhdGVkIGZpbGUgbGlzdCAoY29uc29saWRhdGVkIHRvIDUgZmlsZXMpCgotLS0KCioqUmVtZW1iZXI6IFRoZXNlIHByb3RlY3Rpb25zIGV4aXN0IGJlY2F1c2UgYWdlbnRzIG11c3QgZm9sbG93IHdvcmtmbG93cywgbm90IHJlZGVmaW5lIHRoZW0uKioK'
  }
];

function decodeAgent(meta: EmbeddedAgentMeta): AgentTemplate {
  const raw = Buffer.from(meta.base64.replace(/\n/g, ''), 'base64').toString('utf8');
  return { id: meta.id, filename: meta.filename, title: meta.title, content: raw };
}

function decodeFile(meta: EmbeddedFileMeta): ProtectedFile {
  const raw = Buffer.from(meta.base64.replace(/\n/g, ''), 'base64').toString('utf8');
  return { id: meta.id, filename: meta.filename, title: meta.title, content: raw };
}

async function loadWorkspaceAgents(): Promise<AgentTemplate[]> {
  try {
    const vscode = await import('vscode');
    const files = await vscode.workspace.findFiles('**/.github/agents/*.agent.md', '**/node_modules/**');
    if (!files.length) return [];
    const agents: AgentTemplate[] = [];
    for (const uri of files) {
      const buf = await vscode.workspace.fs.readFile(uri);
      const text = buf.toString();
      const filename = uri.path.split('/').pop() || 'agent.md';
      const id = filename.replace(/\.agent\.md$/, '').toLowerCase();
      // Prefer YAML frontmatter name: or first markdown heading
      const nameMatch = text.match(/^name:\s*(.+)$/m);
      const headingMatch = text.match(/^#\s*(.+)$/m);
      const title = nameMatch ? nameMatch[1].trim() : (headingMatch ? headingMatch[1].trim() : filename.replace(/\.agent\.md$/, ''));
      agents.push({ id, filename, title, content: text });
    }
    return agents;
  } catch (e) {
    console.error('Failed to load workspace agents', e);
    return [];
  }
}

export async function getAgents(source: 'embedded' | 'workspace' | 'auto' = 'embedded'): Promise<AgentTemplate[]> {
  if (source === 'workspace') {
    const wsAgents = await loadWorkspaceAgents();
    if (wsAgents.length) return wsAgents;
  }
  if (source === 'auto') {
    const wsAgents = await loadWorkspaceAgents();
    if (wsAgents.length) return wsAgents;
  }
  return embeddedAgentsData.map(decodeAgent);
}

export function getProtectedFilesEmbedded(): ProtectedFile[] {
  return embeddedProtectedFilesData.map(decodeFile);
}
